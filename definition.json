{
    "actionClass": ["Fusio\\Adapter\\Sample\\Action\\TodoFetchAllCustom"],
    "schema": [
        {
            "name": "Todo",
            "source": {
                "type": "object",
                "title": "todo",
                "properties": {
                    "id": {
                        "type": "integer"
                    },
                    "status": {
                        "type": "integer"
                    },
                    "title": {
                        "type": "string"
                    },
                    "insertDate": {
                        "type": "string",
                        "format": "date-time"
                    }
                }
            }
        },
        {
            "name": "Todo-Message",
            "source": {
                "type": "object",
                "title": "message",
                "properties": {
                    "success": {
                        "type": "boolean"
                    },
                    "message": {
                        "type": "string"
                    }
                }
            }
        },
        {
            "name": "Todo-Collection",
            "source": {
                "id": "http:\/\/acme.com\/schema",
                "type": "object",
                "title": "collection",
                "properties": {
                    "totalCount": {
                        "type": "integer"
                    },
                    "entry": {
                        "type": "array",
                        "items": {
                            "$ref": "schema:\/\/\/Todo"
                        }
                    }
                }
            }
        }
    ],
    "action": [
        {
            "name": "Todo-Custom",
            "class": "Fusio\\Adapter\\Sample\\Action\\TodoFetchAllCustom",
            "config": {
                "connection": "${connection}"
            }
        },
        {
            "name": "Todo-SQL-Table",
            "class": "Fusio\\Adapter\\Sql\\Action\\SqlTable",
            "config": {
                "connection": "${connection}",
                "table": "app_todo"
            }
        },
        {
            "name": "Todo-Delete",
            "class": "Fusio\\Adapter\\V8\\Action\\V8Processor",
            "config": {
                "code": "var connection = connector.get('${connection}');\n\nvar sql = 'UPDATE app_todo SET status = 0 WHERE id = :id';\nconnection.executeUpdate(sql, {\n\tid: request.getUriFragment('todo_id')\n});\n\nresponse.setBody({\n\tsuccess: true\n});\n"
            }
        },
        {
            "name": "Todo-Row",
            "class": "Fusio\\Adapter\\V8\\Action\\V8Processor",
            "config": {
                "code": "var connection = connector.get('${connection}');\n\nvar sql = 'SELECT id, status, title, insertDate FROM app_todo WHERE id = :id';\nvar row = connection.fetchAssoc(sql, {\n\tid: request.getUriFragment('todo_id')\n});\n\nif (row) {\n\tresponse.setBody(row);\n} else {\n\tresponse.setStatusCode(404);\n\tresponse.setBody({\n\t\tsuccess: false, \n\t\tmessage: 'Entry not available'\n\t});\n}\n"
            }
        },
        {
            "name": "Todo-Update",
            "class": "Fusio\\Adapter\\V8\\Action\\V8Processor",
            "config": {
                "code": "var connection = connector.get('${connection}');\n\nvar sql = 'UPDATE app_todo SET status = :status, title = :title WHERE id = :id';\nvar body = request.getBody();\nvar row = connection.executeUpdate(sql, {\n\tstatus: body.status,\n\ttitle: body.title,\n\tid: request.getUriFragment('todo_id')\n});\n\nresponse.setBody({\n\tsuccess: true\n});\n"
            }
        }
    ],
    "routes": [
        {
            "path": "\/todo",
            "config": [
                {
                    "status": 4,
                    "version": 1,
                    "methods": {
                        "GET": {
                            "active": true,
                            "public": true,
                            "action": "Todo-SQL-Table",
                            "response": "Todo-Collection"
                        },
                        "POST": {
                            "active": true,
                            "action": "Todo-SQL-Table",
                            "request": "Todo",
                            "response": "Passthru"
                        },
                        "PUT": {
                            "active": false
                        },
                        "DELETE": {
                            "active": false
                        }
                    }
                }
            ]
        },
        {
            "path": "\/todo\/:todo_id",
            "config": [
                {
                    "status": 4,
                    "version": 1,
                    "methods": {
                        "GET": {
                            "active": true,
                            "public": true,
                            "action": "Todo-Row",
                            "response": "Todo"
                        },
                        "POST": {
                            "active": false
                        },
                        "PUT": {
                            "active": true,
                            "action": "Todo-Update",
                            "request": "Todo",
                            "response": "Todo-Message"
                        },
                        "DELETE": {
                            "active": true,
                            "action": "Todo-Delete",
                            "response": "Todo-Message"
                        }
                    }
                }
            ]
        }
    ]
}
